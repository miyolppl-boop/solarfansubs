<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SolarFansub</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
header{position:fixed;top:0;left:0;width:100%;background:#000;z-index:1000;
display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:1px solid #222}
.logo{color:#FFD84D;font-weight:bold}
.menu-btn{font-size:26px;color:#FFD84D;cursor:pointer}
.section{padding:90px 15px}
.title{font-size:22px;border-left:4px solid #FFD84D;padding-left:10px;margin:15px 0}
.card{background:#111;border:1px solid #222;border-radius:12px;padding:15px;margin-bottom:12px;cursor:pointer}
.card:hover{border-color:#FFD84D}
.side-menu{position:fixed;top:0;right:-100%;width:85%;max-width:320px;height:100%;
background:#0c0c0c;padding:20px;transition:.3s;z-index:2000;overflow-y:auto}
.side-menu.active{right:0}
.side-menu button,.side-menu a{
width:100%;margin-bottom:10px;padding:12px;border-radius:8px;border:none;
background:#FFD84D;color:#000;font-weight:bold;text-decoration:none;display:block}
.side-menu a{background:#111;color:#FFD84D}
.input,textarea{width:100%;padding:12px;margin-bottom:10px;border-radius:8px;border:none;background:#222;color:#fff}
.reader img{width:100%;margin-bottom:10px;border-radius:6px}
.new-badge{background:#ff2d2d;color:#fff;font-size:11px;padding:3px 6px;border-radius:6px;margin-left:6px}
footer{text-align:center;color:#777;padding:30px;font-size:12px}
</style>
</head>

<body>

<header>
<div class="logo">☀ SolarFansub</div>
<div class="menu-btn" onclick="menu.classList.toggle('active')">☰</div>
</header>

<div class="side-menu" id="menu">
<button onclick="openLogin()">Üye Girişi</button>
<button onclick="openRegister()">Üye Kaydı</button>
<a onclick="showHome()">Ana Sayfa</a>
<a onclick="showFavorites()">Favoriler</a>
<a onclick="adminLogin()">Admin Panel</a>
</div>

<div class="section" id="content"></div>
<footer>© SolarFansub</footer>

<!-- LOGIN / REGISTER -->
<div class="modal" id="loginModal"></div>
<div class="modal" id="registerModal"></div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyCwXSQt42wLmbFvaUczzKMDUBPNfkH91S0",
authDomain:"solarfansubs-23416.firebaseapp.com",
projectId:"solarfansubs-23416",
storageBucket:"solarfansubs-23416.appspot.com"
});

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

function showHome(){
content.innerHTML='<div class="title">Seriler</div>';
db.collection("series").onSnapshot(s=>{
content.innerHTML='<div class="title">Seriler</div>';
s.forEach(d=>{
content.innerHTML+=`
<div class="card" onclick="openSeries('${d.id}')">${d.data().name}</div>`;
});
});
}

function openSeries(id){
db.collection("series").doc(id).get().then(d=>{
content.innerHTML=`<div class="title">${d.data().name}</div>`;
db.collection("series").doc(id).collection("chapters").orderBy("no")
.onSnapshot(c=>{
c.forEach(ch=>{
let isNew=Date.now()-ch.data().created<3*86400000;
content.innerHTML+=`
<div class="card" onclick="openReader('${id}',${ch.data().no})">
Bölüm ${ch.data().no}
${isNew?'<span class="new-badge">NEW</span>':''}
</div>`;
});
});
});
}

async function openReader(seriesId,no){
content.innerHTML=`<div class="title">Bölüm ${no}</div><div class="reader">`;
const ref=db.collection("series").doc(seriesId)
.collection("chapters").doc(String(no));
const doc=await ref.get();
const pages=doc.data().pages||0;

for(let i=1;i<=pages;i++){
const url=await storage.ref(`series/${seriesId}/chapters/${no}/${i}.jpg`).getDownloadURL();
content.innerHTML+=`<img src="${url}">`;
}

content.innerHTML+=`<div id="disqus_thread"></div>`;
loadDisqus(seriesId,no);
}

function loadDisqus(seriesId,no){
window.disqus_config=function(){
this.page.identifier=seriesId+"-"+no;
this.page.url=location.href;
};
if(window.DISQUS){
DISQUS.reset({reload:true,config:disqus_config});
}else{
let d=document,s=d.createElement("script");
s.src="https://solarfansub-demo.disqus.com/embed.js";
s.setAttribute("data-timestamp",+new Date());
(d.body).appendChild(s);
}
}

function adminLogin(){
auth.onAuthStateChanged(u=>{
if(!u||u.email!=="flesflww@gmail.com")return alert("Yetkin yok");
content.innerHTML=`
<div class="title">Admin Panel</div>
<input class="input" id="sid" placeholder="Seri ID">
<input class="input" id="chap" placeholder="Bölüm No">
<input class="input" type="file" id="imgs" multiple>
<button onclick="uploadChapter()">Bölüm Yükle</button>`;
});
}

async function uploadChapter(){
const sid=sid.value;
const no=chap.value;
const files=imgs.files;
for(let i=0;i<files.length;i++){
await storage.ref(`series/${sid}/chapters/${no}/${i+1}.jpg`).put(files[i]);
}
await db.collection("series").doc(sid)
.collection("chapters").doc(String(no))
.set({no:Number(no),pages:files.length,created:Date.now()});
alert("Yüklendi");
}

showHome();
</script>

</body>
</html>
