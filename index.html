<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SolarFansub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{margin:0;background:#000;color:#fff;font-family:Arial}
header{position:fixed;top:0;width:100%;background:#000;border-bottom:1px solid #222;
display:flex;justify-content:space-between;align-items:center;padding:15px;z-index:9}
.logo{color:#FFD84D;font-weight:bold}
.menu{font-size:26px;color:#FFD84D;cursor:pointer}
.section{padding:90px 15px}
.card{background:#111;border:1px solid #222;border-radius:12px;padding:15px;margin-bottom:12px;cursor:pointer}
.card:hover{border-color:#FFD84D}
.side{position:fixed;top:0;right:-100%;width:85%;max-width:320px;height:100%;
background:#0c0c0c;padding:20px;transition:.3s;z-index:10}
.side.active{right:0}
.side button,.side a{width:100%;padding:12px;margin-bottom:10px;border:none;border-radius:8px;
background:#FFD84D;color:#000;font-weight:bold;text-decoration:none}
.side a{background:#111;color:#FFD84D}
.input{width:100%;padding:12px;margin-bottom:10px;border:none;border-radius:8px;background:#222;color:#fff}
.reader img{width:100%;margin-bottom:10px;border-radius:6px}
.progress{width:100%;background:#222;border-radius:6px;overflow:hidden;margin-bottom:10px}
.bar{height:8px;width:0;background:#FFD84D}
</style>
</head>

<body>

<header>
<div class="logo">â˜€ SolarFansub</div>
<div class="menu" onclick="side.classList.toggle('active')">â˜°</div>
</header>

<div class="side" id="side">
<button onclick="login()">GiriÅŸ</button>
<button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
<a onclick="home()">Ana Sayfa</a>
<a onclick="admin()">Admin Panel</a>
</div>

<div class="section" id="content"></div>

<script>
// ðŸ”¥ FIREBASE
firebase.initializeApp({
apiKey:"AIzaSyCwXSQt42wLmbFvaUczzKMDUBPNfkH91S0",
authDomain:"solarfansubs-23416.firebaseapp.com",
projectId:"solarfansubs-23416",
storageBucket:"solarfansubs-23416.appspot.com"
});
const auth=firebase.auth();
const db=firebase.firestore();
const st=firebase.storage();

// AUTH
function login(){
const e=prompt("E-posta");
const p=prompt("Åžifre");
auth.signInWithEmailAndPassword(e,p)
.then(()=>alert("GiriÅŸ baÅŸarÄ±lÄ±"))
.catch(err=>alert(err.message));
}
function logout(){auth.signOut();alert("Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±")}

// HOME
function home(){
content.innerHTML="<h2>Seriler</h2>";
db.collection("series").onSnapshot(s=>{
content.innerHTML="<h2>Seriler</h2>";
s.forEach(d=>{
content.innerHTML+=`<div class="card" onclick="openSeries('${d.id}')">${d.data().name}</div>`;
});
});
}

// SERIES
function openSeries(id){
db.collection("series").doc(id).get().then(d=>{
content.innerHTML=`<h2>${d.data().name}</h2>`;
db.collection("series").doc(id).collection("chapters").orderBy("no")
.onSnapshot(c=>{
c.forEach(ch=>{
content.innerHTML+=`<div class="card" onclick="reader('${id}',${ch.data().no})">
BÃ¶lÃ¼m ${ch.data().no}</div>`;
});
});
});
}

// READER
async function reader(sid,no){
content.innerHTML="";
const d=await db.collection("series").doc(sid)
.collection("chapters").doc(String(no)).get();
for(let i=1;i<=d.data().pages;i++){
const u=await st.ref(`series/${sid}/${no}/${i}.jpg`).getDownloadURL();
content.innerHTML+=`<img class="reader" src="${u}">`;
}
}

// ADMIN
function admin(){
auth.onAuthStateChanged(u=>{
if(!u || u.email!=="flesflww@gmail.com") return alert("Yetkin yok");

content.innerHTML=`
<h2>Admin Panel</h2>

<select id="seriesSelect" class="input"></select>

<input id="chapterNo" class="input" placeholder="BÃ¶lÃ¼m numarasÄ± (Ã¶rnek: 5)">

<input type="file" id="photos" class="input" multiple accept="image/*">

<div class="progress"><div class="bar" id="bar"></div></div>

<button onclick="upload()">BÃ¶lÃ¼mÃ¼ YÃ¼kle</button>
`;

db.collection("series").get().then(s=>{
s.forEach(d=>{
seriesSelect.innerHTML+=`<option value="${d.id}">${d.data().name}</option>`;
});
});
});
}

// UPLOAD (MANUEL BÃ–LÃœM NO)
async function upload(){
const sid=seriesSelect.value;
const no=chapterNo.value;
const files=photos.files;
if(!sid||!no||!files.length) return alert("Eksik alan");

let uploaded=0;
for(let i=0;i<files.length;i++){
const task=st.ref(`series/${sid}/${no}/${i+1}.jpg`).put(files[i]);
task.on("state_changed",snap=>{
const p=((i+snap.bytesTransferred/snap.totalBytes)/files.length)*100;
bar.style.width=p+"%";
});
await task;
uploaded++;
}

await db.collection("series").doc(sid)
.collection("chapters").doc(String(no))
.set({no:Number(no),pages:files.length,created:Date.now()});

alert("BÃ¶lÃ¼m yÃ¼klendi âœ”");
bar.style.width="0%";
}

home();
</script>
</body>
</html>
