<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SolarFansub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0c0c0c;color:#eee}
header{background:#000;padding:12px 16px;display:flex;gap:10px;align-items:center}
.logo{color:#f5d76e;font-size:20px;font-weight:bold;cursor:pointer}
input,textarea,button,select{padding:8px;border-radius:6px;border:none;width:100%;margin:4px 0}
button{background:#f5d76e;color:#000;cursor:pointer}
.container{padding:16px}
.section-title{font-size:20px;color:#f5d76e;border-bottom:2px solid #f5d76e;margin:25px 0 10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px}
.card{background:#151515;border-radius:8px;padding:10px;text-align:center;cursor:pointer}
.card img{width:100%;height:230px;object-fit:cover;border-radius:6px}
.hidden{display:none}
.chapter{background:#1f1f1f;padding:10px;border-radius:6px;margin:6px 0;cursor:pointer}
.new{color:#0f0;font-size:12px;margin-left:6px}
.reader img{width:100%;margin-bottom:10px}
.admin-box{position:fixed;right:10px;bottom:10px;background:#111;padding:10px;border-radius:8px;width:260px}
</style>
</head>

<body>

<header>
<div class="logo" onclick="goHome()">SolarFansub</div>
<input id="search" placeholder="Seri ara..." oninput="renderSeries()">
</header>

<div id="home" class="container"></div>
<div id="detail" class="container hidden"></div>
<div id="reader" class="container hidden reader"></div>

<div class="admin-box" id="adminLoginBox">
<input id="adminPass" type="password" placeholder="Admin ÅŸifre">
<button onclick="adminLogin()">Admin GiriÅŸ</button>
</div>

<div class="container hidden" id="adminPanel">
<h2>Admin Paneli</h2>

<input id="sTitle" placeholder="Seri adÄ±">
<input id="sCover" type="file" accept="image/*">
<textarea id="sDesc" placeholder="AÃ§Ä±klama"></textarea>
<input id="sGenres" placeholder="TÃ¼rler (virgÃ¼lle)">
<select id="sStatus">
<option>Devam Ediyor</option>
<option>Bitti</option>
</select>
<button onclick="addSeries()">â• Seri Ekle</button>

<hr>

<select id="seriesSelect"></select>
<input id="cTitle" placeholder="BÃ¶lÃ¼m adÄ±">
<input id="cPages" type="file" multiple accept="image/*">
<button onclick="addChapter()">ğŸ“š BÃ¶lÃ¼m Ekle</button>

<button onclick="logout()">ğŸšª Admin Ã‡Ä±kÄ±ÅŸ</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC3ccMdaINKIkNYP8ewXiOmwO875djv45c",
  authDomain: "solarfansubs-4db5c.firebaseapp.com",
  projectId: "solarfansubs-4db5c",
  storageBucket: "solarfansubs-4db5c.firebasestorage.app",
  messagingSenderId: "179563514962",
  appId: "1:179563514962:web:87c42527ce9c38d005638b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ADMIN_PASSWORDS=["alamuzpulums&129qam","admin2"];
let series=[];

window.goHome=()=>{detail.classList.add("hidden");reader.classList.add("hidden");home.classList.remove("hidden");renderSeries();}

async function loadSeries(){
series=[];
const snap=await getDocs(collection(db,"series"));
snap.forEach(d=>series.push({...d.data(),fid:d.id}));
renderSeries(); updateSeriesSelect();
}
loadSeries();

window.renderSeries=()=>{
home.innerHTML="";
const q=search.value.toLowerCase();
let list=series.filter(s=>s.title.toLowerCase().includes(q));
let popular=[...list].sort((a,b)=>b.views-a.views).slice(0,6);
let others=list.filter(s=>!popular.includes(s));

home.innerHTML=`
<div class="section-title">â­ PopÃ¼ler Seriler</div>
<div class="grid">${popular.map(card).join("")}</div>
<div class="section-title">ğŸ“š DiÄŸer Seriler</div>
<div class="grid">${others.map(card).join("")}</div>`;
}

const card=s=>`
<div class="card" onclick="openSeries('${s.fid}')">
<img src="${s.cover}">
<b>${s.title}</b>
</div>`;

window.openSeries=async id=>{
const s=series.find(x=>x.fid===id);
await updateDoc(doc(db,"series",id),{views:increment(1)});
home.classList.add("hidden");
detail.classList.remove("hidden");

detail.innerHTML=`
<h2>${s.title}</h2>
<img src="${s.cover}" style="max-width:240px">
<p>${s.desc}</p>
<p><b>TÃ¼rler:</b> ${s.genres.join(", ")}</p>
<p><b>Durum:</b> ${s.status}</p>
<h3>BÃ¶lÃ¼mler</h3>
${(s.chapters||[]).map(c=>`
<div class="chapter" onclick="openChapter('${id}',${c.created})">
${c.title} ${Date.now()-c.created<86400000?'<span class="new">NEW</span>':''}
</div>`).join("")}`;
}

window.openChapter=(sid,cid)=>{
const s=series.find(x=>x.fid===sid);
const c=s.chapters.find(x=>x.created===cid);
detail.classList.add("hidden");
reader.classList.remove("hidden");
reader.innerHTML=c.pages.map(p=>`<img src="${p}">`).join("");
}

window.adminLogin=()=>{
if(ADMIN_PASSWORDS.includes(adminPass.value)){
adminLoginBox.classList.add("hidden");
adminPanel.classList.remove("hidden");
}else alert("HatalÄ± ÅŸifre");
}

window.logout=()=>{adminPanel.classList.add("hidden");adminLoginBox.classList.remove("hidden");}

window.addSeries=()=>{
const r=new FileReader();
r.onload=async e=>{
await addDoc(collection(db,"series"),{
title:sTitle.value,
cover:e.target.result,
desc:sDesc.value,
genres:sGenres.value.split(","),
status:sStatus.value,
views:0,
chapters:[]
});
loadSeries();
};
r.readAsDataURL(sCover.files[0]);
}

window.addChapter=async()=>{
const files=[...cPages.files];
let pages=[];
for(const f of files){
const r=new FileReader();
await new Promise(res=>{
r.onload=e=>{pages.push(e.target.result);res();}
r.readAsDataURL(f);
});
}
await updateDoc(doc(db,"series",seriesSelect.value),{
chapters:arrayUnion({
title:cTitle.value,
pages,
created:Date.now()
})
});
alert("BÃ¶lÃ¼m eklendi");
loadSeries();
}

window.updateSeriesSelect=()=>{
seriesSelect.innerHTML=series.map(s=>`<option value="${s.fid}">${s.title}</option>`).join("");
}
</script>

</body>
</html>
