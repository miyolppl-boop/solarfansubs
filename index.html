<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SolarFansub</title>
<meta name="description" content="SolarFansub - TÃ¼rkÃ§e manhwa ve manga okuma sitesi.">
<link rel="icon" href="logo.png">

<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:#f5f5dc}
header{background:#000;padding:10px 15px;display:flex;justify-content:space-between;align-items:center}
h1{color:#f5d76e;font-size:20px;margin:0;cursor:pointer}
.menu-btn{font-size:22px;color:#f5d76e;cursor:pointer}
#menu{position:fixed;right:-260px;top:0;width:260px;height:100%;background:#111;padding:20px;transition:.3s}
#menu.active{right:0}
.hidden{display:none}
#series,#reader,#detail{padding:20px}
.series-card{background:#151515;padding:10px;margin:10px 0;border-radius:6px;cursor:pointer}
.chapter{background:#222;padding:8px;margin-top:5px;border-radius:4px;cursor:pointer}
.page{width:100%;margin-bottom:10px}
.star{font-size:24px;cursor:pointer;color:#555}
.star.active{color:#f5d76e}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
<h1 onclick="goHome()">SolarFansub</h1>
<div class="menu-btn" onclick="menu.classList.toggle('active')">â˜°</div>
</header>

<div id="series"></div>
<div id="detail" class="hidden"></div>
<div id="reader" class="hidden"></div>

<div id="menu">
<div id="loginBox">
<h3>Admin GiriÅŸi</h3>
<input id="email" placeholder="E-mail">
<input id="password" type="password" placeholder="Åifre">
<button onclick="login()">GiriÅŸ</button>
</div>

<div id="adminMenu" class="hidden">
<h3>YÃ¶netim</h3>
<input id="newSeries" placeholder="Yeni Seri">
<button onclick="addSeries()">â• Seri Ekle</button>
<hr>
<input id="oldPass" type="password" placeholder="Eski Åifre">
<input id="newPass" type="password" placeholder="Yeni Åifre">
<button onclick="changePass()">ğŸ” Åifre DeÄŸiÅŸtir</button>
<button onclick="logout()">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
</div>
</div>

<script>
const firebaseConfig={
 apiKey:"BURAYA",
 authDomain:"BURAYA",
 projectId:"BURAYA"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const seriesDiv=series;
const detailDiv=detail;
const readerDiv=reader;

auth.onAuthStateChanged(u=>{
 loginBox.classList.toggle("hidden",!!u);
 adminMenu.classList.toggle("hidden",!u);
});

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(()=>alert("HatalÄ± giriÅŸ"));
}
function logout(){auth.signOut()}
function changePass(){
 auth.currentUser.updatePassword(newPass.value)
 .then(()=>alert("Åifre deÄŸiÅŸti"))
}

function addSeries(){
 db.collection("series").add({title:newSeries.value,rate:[],created:Date.now()});
 newSeries.value="";loadSeries();
}

function loadSeries(){
 seriesDiv.innerHTML="";
 db.collection("series").get().then(s=>{
  s.forEach(d=>{
   const c=document.createElement("div");
   c.className="series-card";
   c.innerText=d.data().title;
   c.onclick=()=>openSeries(d.id,d.data());
   seriesDiv.appendChild(c);
  });
 });
}

function openSeries(id,data){
 seriesDiv.classList.add("hidden");
 detailDiv.classList.remove("hidden");
 detailDiv.innerHTML=`
 <h2 style="text-align:center">${data.title}</h2>
 <div id="stars" style="text-align:center"></div>
 <p style="text-align:center">Ortalama: ${avg(data.rate||[])} / 5</p>
 <hr>
 <div id="chapters"></div>
 `;
 for(let i=1;i<=5;i++){
  const s=document.createElement("span");
  s.className="star";
  s.innerText="â˜…";
  s.onclick=()=>rate(id,i);
  stars.appendChild(s);
 }
 db.collection("series").doc(id).collection("chapters").get().then(cs=>{
  cs.forEach(c=>{
   const ch=document.createElement("div");
   ch.className="chapter";
   ch.innerText=c.data().title;
   ch.onclick=()=>openChapter(id,c.id);
   chapters.appendChild(ch);
  });
 });
}

function rate(id,v){
 if(!auth.currentUser)return alert("GiriÅŸ yap");
 const ref=db.collection("series").doc(id);
 ref.get().then(d=>{
  const r=d.data().rate||[];
  ref.update({rate:[...r,v]});
 });
}

function avg(a){return a.length?(a.reduce((x,y)=>x+y,0)/a.length).toFixed(1):"0"}

function openChapter(s,c){
 detailDiv.classList.add("hidden");
 readerDiv.classList.remove("hidden");
 readerDiv.innerHTML="";
 const ref=db.collection("series").doc(s).collection("chapters").doc(c);
 ref.get().then(d=>{
  d.data().pages.forEach(p=>{
   const i=document.createElement("img");
   i.src=p;i.className="page";
   readerDiv.appendChild(i);
  });
  readerDiv.innerHTML+=`
  <div id="disqus_thread"></div>
  `;
  var d=document,scr=d.createElement("script");
  scr.src="https://DISQUS_SHORTNAME.disqus.com/embed.js";
  scr.setAttribute("data-timestamp",+new Date());
  d.body.appendChild(scr);
 });
}

function goHome(){
 detailDiv.classList.add("hidden");
 readerDiv.classList.add("hidden");
 seriesDiv.classList.remove("hidden");
}

loadSeries();
</script>

</body>
</html>
